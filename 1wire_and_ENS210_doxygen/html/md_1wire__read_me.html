<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>1-Wire and ENS210 driver stack: Improved 1-Wire stack for DS2485 &ndash; &lt;em&gt;1-Wire bus&lt;/em&gt; &ndash; DS28E18</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">1-Wire and ENS210 driver stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Improved 1-Wire stack for DS2485 &ndash; <em>1-Wire bus</em> &ndash; DS28E18 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Background</h1>
<p >I had some difficulty using the software provided by Maxim (now Analog Devices) in one of our projects. Ultimately, I ended up reworking it considerably to get it into shape we could use. Hope this resulting code helps other folks trying to use 1-Wire!</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Modified 1-Wire Stack</h1>
<p >The 1wire directory contains the 1-wire stack based on Maxim-provided code, with modifications listed below to be usable in a real application. Also adds a platform-specific driver for NXP RT1024 using FSL and FreeRTOS, with both DMA (performant) and polling (slow but simpler) implementations.</p>
<p >** Note: ** This is not an Arduino driver. However, as the OS dependencies are now isolated in one source module, this stack can easily be adapted to Arduino, Windows, whatever (just create an appropriate DS2485_port_xxx.c).</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Example ENS210 Driver</h1>
<p >I'm using an ENS210 high-precision temperature and humidity sensor at the end of a long 1-Wire cable. The 1-Wire bus is driven at the host MCU with a DS2485, and at the remote end a DS28E18 controls and powers the ENS210. The C++ driver code for the ENS210 is included here along with the 1-Wire stack.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Maxim code modification summary:</h1>
<ul>
<li>DS2485 refactored for platform independence (isolated low-level platform-specific I2C API)</li>
<li>code cleanup (especially DS28E18), resulting in smaller more maintainable source code, less flash use, and faster runtime:<ul>
<li>fix compile errors</li>
<li>unnecessary includes removed</li>
<li>use standard modern types (uint8_t rather than u_char, etc.)</li>
<li>variable naming greatly improved</li>
<li>replaced some grossly inefficient coding</li>
<li>massive cut-and-paste factored out</li>
<li>use static for local functions and variables</li>
<li>move non-public (non-API) definitions out of API header files</li>
<li>correct function types to match types actually returned (bool confusion)</li>
<li>commentary and Doxygen output expanded and corrected (could still use a lot of improvement)</li>
<li>in APIs, use const when passing read-only arrays (enables constant ie flash-resident data to be passed)</li>
<li>use static const for constant parameter arrays (save code space)</li>
<li>DS28E18 especially: API rationalized</li>
</ul>
</li>
<li>fixed a few bugs</li>
<li>added platform specialization for iMXRT1024 in DS2485_port_NXP_LPI2C.c</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Reference</h1>
<p ><a href="https://www.analog.com/en/products/ds28e18.html#product-tools">Original source from Maxim is in MAXREFDES9004.ZIP file on this DS28E18 product page</a>. Download MAXREFDES9004: C-source Reference for Operating the DS2485 Combined with a DS28E18 from a Cortex-M4 Microcontroller </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
